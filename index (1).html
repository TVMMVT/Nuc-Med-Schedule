<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NucMed Schedule â€” Viewer</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root {
  --bg: #0a0e14; --surface: #131920; --surface2: #1a2332; --border: #263040;
  --accent: #00d4aa; --pet: #7c6ff7; --general: #10b981; --thera: #f59e0b; --support: #ec4899;
  --text: #dce8f5; --text2: #7a90a8; --text3: #4a5a6a; --pto: #f97316;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; font-size: 14px; }
header { background: rgba(10,14,20,0.97); border-bottom: 1px solid var(--border); padding: 0 28px; display: flex; align-items: center; gap: 20px; height: 58px; position: sticky; top: 0; z-index: 100; }
.logo { font-family: 'Space Mono', monospace; font-size: 14px; font-weight: 700; color: var(--accent); letter-spacing: 0.06em; }
nav { display: flex; gap: 2px; flex: 1; }
.nav-btn { background: none; border: none; color: var(--text2); font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 500; padding: 7px 16px; border-radius: 8px; cursor: pointer; transition: all 0.15s; }
.nav-btn:hover { background: var(--surface2); color: var(--text); }
.nav-btn.active { background: var(--surface2); color: var(--accent); }
.live-badge { display: flex; align-items: center; gap: 6px; background: var(--surface2); border: 1px solid var(--border); border-radius: 20px; padding: 5px 12px; font-size: 11px; color: var(--text2); }
.live-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--accent); box-shadow: 0 0 6px var(--accent); animation: glow 2s infinite; }
@keyframes glow { 0%,100%{opacity:1}50%{opacity:0.4} }
main { padding: 28px; max-width: 1440px; margin: 0 auto; }
.page { display: none; animation: fi 0.2s ease; }
.page.active { display: block; }
@keyframes fi { from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)} }
.page-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 28px; gap: 16px; flex-wrap: wrap; }
.page-title { font-family: 'Space Mono', monospace; font-size: 20px; font-weight: 700; }
.page-sub { font-size: 13px; color: var(--text2); margin-top: 4px; }
.controls { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
.search-box, .fsel { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 8px 14px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 13px; outline: none; transition: border-color 0.15s; }
.search-box { width: 200px; } .search-box:focus, .fsel:focus { border-color: var(--accent); }
.dept-pill { display: inline-block; font-size: 11px; font-weight: 600; padding: 2px 9px; border-radius: 20px; text-transform: uppercase; }
.dp-PET { background: rgba(124,111,247,0.15); color: #9d93ff; border: 1px solid rgba(124,111,247,0.3); }
.dp-General { background: rgba(16,185,129,0.15); color: #34d399; border: 1px solid rgba(16,185,129,0.3); }
.dp-Theranostics { background: rgba(245,158,11,0.15); color: #fbbf24; border: 1px solid rgba(245,158,11,0.3); }
.dp-Support { background: rgba(236,72,153,0.15); color: #f472b6; border: 1px solid rgba(236,72,153,0.3); }
.card { background: var(--surface); border: 1px solid var(--border); border-radius: 14px; overflow: hidden; }
.card-header { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
.card-title { font-size: 13px; font-weight: 600; }
.card-body { padding: 20px; }
.g2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.g4 { display: grid; grid-template-columns: repeat(4,1fr); gap: 16px; }
@media(max-width:900px){.g4{grid-template-columns:1fr 1fr}} @media(max-width:600px){.g2,.g4{grid-template-columns:1fr}}
.stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: 14px; padding: 20px; position: relative; overflow: hidden; }
.stat-card::after { content:''; position:absolute; top:0;left:0;right:0;height:2px; }
.sc-pet::after{background:var(--pet)}.sc-gen::after{background:var(--general)}.sc-thera::after{background:var(--thera)}.sc-sup::after{background:var(--support)}
.stat-label { font-size: 11px; font-weight: 600; color: var(--text2); text-transform: uppercase; letter-spacing: 0.08em; }
.stat-val { font-family: 'Space Mono', monospace; font-size: 34px; font-weight: 700; margin: 8px 0 4px; }
.stat-sub { font-size: 12px; color: var(--text2); }
.dt { width: 100%; border-collapse: collapse; }
.dt th { background: var(--surface2); color: var(--text2); font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; padding: 10px 16px; text-align: left; border-bottom: 1px solid var(--border); }
.dt td { padding: 10px 16px; border-bottom: 1px solid rgba(38,48,64,0.6); font-size: 13px; vertical-align: middle; }
.dt tr:last-child td { border-bottom: none; }
.dt tbody tr:hover td { background: rgba(255,255,255,0.015); }
.chip { display: inline-flex; align-items: center; gap: 6px; background: var(--surface2); border: 1px solid var(--border); border-radius: 20px; padding: 3px 10px; font-size: 12px; font-weight: 500; white-space: nowrap; }
.av { width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 8px; font-weight: 700; color: #fff; flex-shrink: 0; }
.sb { font-family: 'Space Mono', monospace; font-size: 11px; color: var(--accent); background: rgba(0,212,170,0.08); padding: 2px 8px; border-radius: 4px; border: 1px solid rgba(0,212,170,0.2); white-space: nowrap; }
.rb { font-size: 11px; font-weight: 600; color: var(--text2); background: var(--bg); border: 1px solid var(--border); padding: 2px 8px; border-radius: 4px; white-space: nowrap; }
.ib { font-size: 11px; background: var(--surface2); border: 1px solid var(--border); color: var(--text2); padding: 3px 9px; border-radius: 20px; }
.ib-g { background: rgba(16,185,129,0.1); color: #34d399; border-color: rgba(16,185,129,0.3); }
.ib-a { background: rgba(245,158,11,0.1); color: #fbbf24; border-color: rgba(245,158,11,0.3); }
.sd { font-family: 'Space Mono', monospace; font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.12em; color: var(--text3); display: flex; align-items: center; gap: 12px; margin: 24px 0 14px; }
.sd::after { content:''; flex:1; height:1px; background: var(--border); }
.mg { display: grid; grid-template-columns: repeat(auto-fill,minmax(290px,1fr)); gap: 20px; }
.mc { background: var(--surface); border: 1px solid var(--border); border-radius: 14px; overflow: hidden; }
.mch { background: var(--surface2); padding: 12px 16px; font-family: 'Space Mono', monospace; font-size: 11px; font-weight: 700; letter-spacing: 0.12em; color: var(--accent); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
.cg { display: grid; grid-template-columns: repeat(7,1fr); }
.cdh { text-align: center; font-size: 9px; font-weight: 700; color: var(--text3); text-transform: uppercase; padding: 7px 2px 5px; background: var(--surface2); }
.cd { text-align: center; padding: 5px 2px; border: 1px solid rgba(38,48,64,0.4); min-height: 48px; }
.cd.hp { background: rgba(249,115,22,0.06); }
.dn { font-family: 'Space Mono', monospace; font-size: 10px; color: var(--text2); display: block; }
.cd.we .dn { color: var(--text3); }
.pt { display: flex; flex-wrap: wrap; gap: 1px; justify-content: center; margin-top: 2px; }
.ptag { font-size: 7px; font-weight: 700; background: rgba(249,115,22,0.2); color: var(--pto); border: 1px solid rgba(249,115,22,0.3); padding: 1px 3px; border-radius: 2px; }
.sg { display: grid; grid-template-columns: repeat(auto-fill,minmax(300px,1fr)); gap: 16px; }
.sc2 { background: var(--surface); border: 1px solid var(--border); border-radius: 14px; padding: 18px; display: flex; gap: 14px; align-items: flex-start; transition: border-color 0.15s; }
.sc2:hover { border-color: rgba(0,212,170,0.3); }
.avl { width: 44px; height: 44px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-family: 'Space Mono', monospace; font-size: 13px; font-weight: 700; color: #fff; flex-shrink: 0; }
.sn { font-size: 14px; font-weight: 600; }
.sm { font-size: 11px; color: var(--text2); margin: 4px 0 8px; line-height: 1.5; }
.sq { display: flex; gap: 6px; flex-wrap: wrap; }
.sp { margin-top: 8px; font-size: 11px; color: var(--text2); }
.spl { font-size: 10px; font-weight: 600; color: var(--pto); text-transform: uppercase; letter-spacing: 0.08em; }
.cr { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
.cl { font-size: 12px; color: var(--text2); width: 110px; text-align: right; }
.ct { flex:1; background: var(--surface2); border-radius: 4px; height: 20px; overflow: hidden; }
.cf { height: 100%; border-radius: 4px; display: flex; align-items: center; justify-content: flex-end; padding-right: 8px; transition: width 0.6s ease; }
.cf span { font-size: 10px; font-weight: 700; color: rgba(255,255,255,0.8); }
.cn { font-family: 'Space Mono', monospace; font-size: 11px; color: var(--text2); width: 28px; }
mark { background: rgba(0,212,170,0.15); color: var(--accent); border-radius: 2px; }
::-webkit-scrollbar{width:5px;height:5px} ::-webkit-scrollbar-track{background:var(--bg)} ::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
.loading { text-align: center; padding: 60px; color: var(--text2); }
.loading-spin { font-size: 32px; animation: spin 1s linear infinite; display: block; margin-bottom: 12px; }
@keyframes spin { to{transform:rotate(360deg)} }
</style>
</head>
<body>
<header>
  <div class="logo">â˜¢ NUCMED</div>
  <nav>
    <button class="nav-btn active" onclick="goTo('dashboard',this)">Dashboard</button>
    <button class="nav-btn" onclick="goTo('schedule',this)">Schedule</button>
    <button class="nav-btn" onclick="goTo('pto',this)">PTO Calendar</button>
    <button class="nav-btn" onclick="goTo('staff',this)">Staff Roster</button>
  </nav>
  <div class="live-badge"><div class="live-dot"></div><span id="live-lbl">Connecting...</span></div>
</header>
<main>

<!-- DASHBOARD -->
<div class="page active" id="page-dashboard">
  <div class="page-header">
    <div><div class="page-title">Overview</div><div class="page-sub" id="dash-sub">Loading...</div></div>
  </div>
  <div class="g4" style="margin-bottom:24px" id="stats"></div>
  <div class="g2" style="margin-bottom:20px">
    <div class="card">
      <div class="card-header"><div class="card-title" id="today-ttl">Today's Assignments</div><span class="ib ib-g" id="today-cnt"></span></div>
      <div style="overflow-x:auto"><table class="dt" id="today-tbl"></table></div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-title">Department Distribution</div></div>
      <div class="card-body" id="dept-chart"></div>
    </div>
  </div>
  <div class="g2">
    <div class="card">
      <div class="card-header"><div class="card-title">This Week at a Glance</div></div>
      <div style="overflow-x:auto"><table class="dt" id="week-tbl"></table></div>
    </div>
    <div class="card">
      <div class="card-header"><div class="card-title">Upcoming PTO</div><span class="ib ib-a">Next 60 days</span></div>
      <div class="card-body" id="pto-up"></div>
    </div>
  </div>
</div>

<!-- SCHEDULE -->
<div class="page" id="page-schedule">
  <div class="page-header">
    <div><div class="page-title">Daily Schedule</div><div class="page-sub" id="sched-sub">Live from database</div></div>
    <div class="controls">
      <select class="fsel" id="f-dept" onchange="renderSchedule()">
        <option value="">All Departments</option>
        <option>PET</option><option>General</option><option>Theranostics</option><option>Support</option>
      </select>
      <input class="search-box" placeholder="Search tech or roomâ€¦" id="f-tech" oninput="renderSchedule()" />
    </div>
  </div>
  <div id="sched-body"></div>
</div>

<!-- PTO -->
<div class="page" id="page-pto">
  <div class="page-header">
    <div><div class="page-title">PTO Calendar 2026</div><div class="page-sub">Staff vacation & time-off</div></div>
    <div class="controls">
      <select class="fsel" id="f-pto-staff" onchange="renderPTO()"><option value="">All Staff</option></select>
      <input class="search-box" placeholder="Filter by nameâ€¦" id="f-pto-srch" oninput="renderPTO()" />
    </div>
  </div>
  <div class="mg" id="pto-grid"></div>
</div>

<!-- STAFF -->
<div class="page" id="page-staff">
  <div class="page-header">
    <div><div class="page-title">Staff Roster</div><div class="page-sub" id="staff-sub">Loading...</div></div>
    <div class="controls">
      <select class="fsel" id="f-qual" onchange="renderStaff()">
        <option value="">All Qualifications</option>
        <option>PET</option><option>General</option><option>Theranostics</option>
      </select>
      <input class="search-box" placeholder="Search staffâ€¦" id="f-staff" oninput="renderStaff()" />
    </div>
  </div>
  <div class="sg" id="staff-grid"></div>
</div>

</main>
<script>
const SUPA_URL = 'https://pkpbeiewrfrmevrokesc.supabase.co';
const SUPA_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBrcGJlaWV3cmZybWV2cm9rZXNjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4NjM4MTYsImV4cCI6MjA4NzQzOTgxNn0.ZTS48kvRvWr_jqJigleljCQXWc0peTJQl6GIY_wrp68';
const sb = supabase.createClient(SUPA_URL, SUPA_KEY);

let STAFF=[], SCHEDULE=[], PTO=[];

const MONTHS = {February:{n:2,d:28},March:{n:3,d:31},April:{n:4,d:30},May:{n:5,d:31},June:{n:6,d:30},July:{n:7,d:31},August:{n:8,d:31},September:{n:9,d:30},October:{n:10,d:31},November:{n:11,d:30},December:{n:12,d:31}};
const TC=['#7c6ff7','#10b981','#f59e0b','#ec4899','#3b82f6','#8b5cf6','#ef4444','#06b6d4','#84cc16','#f97316','#14b8a6','#a855f7'];
function tc(n){let h=0;for(const c of n)h=(h*31+c.charCodeAt(0))&0xffffffff;return TC[Math.abs(h)%TC.length];}
function inits(name){const s=STAFF.find(x=>x.name===name);return s?s.initials:(name.match(/\(([^)]+)\)/)||[,'??'])[1];}
function chip(name){return`<span class="chip"><span class="av" style="background:${tc(name)}">${inits(name)}</span>${name}</span>`;}
function dp(dept){return`<span class="dept-pill dp-${dept.replace(/\s/g,'')}">${dept}</span>`;}
function fmtD(iso){return new Date(iso+'T12:00:00').toLocaleDateString('en-US',{weekday:'long',month:'short',day:'numeric'});}
function hl(t,q){if(!q)return t;return t.replace(new RegExp(`(${q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`, 'gi'),'<mark>$1</mark>');}
function wkDates(){return[...new Set(SCHEDULE.map(s=>s.shift_date))].sort().slice(0,10);}
function closest(ds){const t=new Date().toISOString().split('T')[0];const u=ds.filter(d=>d>=t);return u.length?u[0]:ds[ds.length-1];}
function dow(y,m){return new Date(y,m-1,1).getDay();}

function goTo(id,btn){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  if(btn) btn.classList.add('active');
}

async function loadAll(){
  document.getElementById('live-lbl').textContent='Loading...';
  try {
    const [s1,s2,s3] = await Promise.all([
      sb.from('staff').select('*').order('name'),
      sb.from('schedule').select('*').order('shift_date'),
      sb.from('pto').select('*').order('pto_date'),
    ]);
    STAFF=s1.data||[]; SCHEDULE=s2.data||[]; PTO=s3.data||[];
    document.getElementById('live-lbl').textContent='Live Â· '+new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
    renderAll();
  } catch(e) {
    document.getElementById('live-lbl').textContent='Connection error';
    console.error(e);
  }
}

function renderAll(){
  // PTO filter
  const ps=document.getElementById('f-pto-staff');
  ps.innerHTML='<option value="">All Staff</option>'+STAFF.map(s=>`<option>${s.name}</option>`).join('');
  renderDashboard(); renderSchedule(); renderPTO(); renderStaff();
}

function renderDashboard(){
  const dates=wkDates(); if(!dates.length) return;
  const today=closest(dates);
  const te=SCHEDULE.filter(s=>s.shift_date===today);
  document.getElementById('dash-sub').textContent=`Week of ${fmtD(dates[0])}`;
  const dc={PET:0,General:0,Theranostics:0,Support:0};
  te.forEach(s=>{if(dc[s.department]!==undefined)dc[s.department]++;});
  const sc=[{k:'PET',c:'sc-pet',col:'#9d93ff',l:'PET'},{k:'General',c:'sc-gen',col:'#34d399',l:'General'},{k:'Theranostics',c:'sc-thera',col:'#fbbf24',l:'Theranostics'},{k:'Support',c:'sc-sup',col:'#f472b6',l:'Support'}];
  document.getElementById('stats').innerHTML=sc.map(x=>`<div class="stat-card ${x.c}"><div class="stat-label">${x.l}</div><div class="stat-val" style="color:${x.col}">${dc[x.k]}</div><div class="stat-sub">Shifts today</div></div>`).join('');
  document.getElementById('today-ttl').textContent=`Assignments â€” ${fmtD(today)}`;
  document.getElementById('today-cnt').textContent=`${te.length} shifts`;
  document.getElementById('today-tbl').innerHTML=`<thead><tr><th>Dept</th><th>Room</th><th>Shift</th><th>Tech</th></tr></thead><tbody>${te.map(s=>`<tr><td>${dp(s.department)}</td><td><span class="rb">${s.room}</span></td><td><span class="sb">${s.shift_time}</span></td><td>${chip(s.assigned_tech)}</td></tr>`).join('')}</tbody>`;
  // chart
  const ac={};SCHEDULE.forEach(s=>{ac[s.department]=(ac[s.department]||0)+1;});
  const mv=Math.max(...Object.values(ac),1);
  const dc2={PET:'#7c6ff7',General:'#10b981',Theranostics:'#f59e0b',Support:'#ec4899'};
  document.getElementById('dept-chart').innerHTML=Object.entries(ac).map(([d,n])=>`<div class="cr"><div class="cl">${d}</div><div class="ct"><div class="cf" style="width:${(n/mv*100).toFixed(0)}%;background:${dc2[d]||'#888'}"><span>${n}</span></div></div><div class="cn">${n}</div></div>`).join('');
  // week
  const wd=dates.slice(0,5);
  const slots=[...new Set(SCHEDULE.filter(s=>wd.includes(s.shift_date)).map(s=>s.room+'|'+s.shift_time))].sort();
  const dh=wd.map(d=>new Date(d+'T12:00:00').toLocaleDateString('en-US',{weekday:'short',month:'numeric',day:'numeric'}));
  document.getElementById('week-tbl').innerHTML=`<thead><tr><th>Room/Shift</th>${dh.map(h=>`<th>${h}</th>`).join('')}</tr></thead><tbody>${slots.map(sl=>{const[rm,sh]=sl.split('|');return`<tr><td><span class="rb">${rm}</span> <span class="sb" style="font-size:10px">${sh}</span></td>${wd.map(d=>{const e=SCHEDULE.find(s=>s.shift_date===d&&s.room===rm&&s.shift_time===sh);return`<td>${e?chip(e.assigned_tech):'<span style="color:var(--text3)">â€”</span>'}</td>`;}).join('')}</tr>`;}).join('')}</tbody>`;
  // upcoming pto
  const t=new Date().toISOString().split('T')[0];
  const cut=new Date();cut.setDate(cut.getDate()+60);
  const up=PTO.filter(p=>p.pto_date>=t&&new Date(p.pto_date)<=cut).sort((a,b)=>a.pto_date.localeCompare(b.pto_date));
  const grp={};up.forEach(p=>{if(!grp[p.staff_name])grp[p.staff_name]=[];grp[p.staff_name].push(p.pto_date);});
  document.getElementById('pto-up').innerHTML=Object.entries(grp).slice(0,10).map(([n,ds])=>`<div style="display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid rgba(38,48,64,0.6)">${chip(n)}<span style="font-size:12px;color:var(--text2)">${new Date(ds[0]+'T12:00:00').toLocaleDateString('en-US',{month:'short',day:'numeric'})}${ds.length>1?' â€“ '+new Date(ds[ds.length-1]+'T12:00:00').toLocaleDateString('en-US',{month:'short',day:'numeric'}):''}</span></div>`).join('')||'<div style="color:var(--text2);font-size:13px">No PTO in the next 60 days</div>';
}

function renderSchedule(){
  const dF=document.getElementById('f-dept').value;
  const sF=document.getElementById('f-tech').value.toLowerCase().trim();
  const dates=wkDates();
  let html='';
  dates.forEach(date=>{
    let e=SCHEDULE.filter(s=>s.shift_date===date);
    if(dF) e=e.filter(s=>s.department===dF);
    if(sF) e=e.filter(s=>s.assigned_tech.toLowerCase().includes(sF)||s.room.toLowerCase().includes(sF));
    if(!e.length) return;
    html+=`<div class="sd">${fmtD(date)}<span style="color:var(--text3)">${e.length} shifts</span></div>`;
    html+=`<div class="card" style="margin-bottom:0"><div style="overflow-x:auto"><table class="dt"><thead><tr><th>Dept</th><th>Room</th><th>Shift</th><th>Tech</th></tr></thead><tbody>`;
    e.forEach(s=>{html+=`<tr><td>${dp(s.department)}</td><td><span class="rb">${s.room}</span></td><td><span class="sb">${s.shift_time}</span></td><td>${chip(s.assigned_tech)}</td></tr>`;});
    html+=`</tbody></table></div></div>`;
  });
  if(!html) html=`<div style="text-align:center;padding:48px;color:var(--text2)">No entries match your filters</div>`;
  document.getElementById('sched-body').innerHTML=html;
  document.getElementById('sched-sub').textContent=`${SCHEDULE.length} shifts in database Â· ${dates.length} days`;
}

function renderPTO(){
  const sF=document.getElementById('f-pto-staff').value;
  const srch=document.getElementById('f-pto-srch').value.toLowerCase().trim();
  let html='';
  Object.entries(MONTHS).forEach(([month,info])=>{
    const start=dow(2026,info.n);
    // build day->initials map
    const dayMap={};
    PTO.filter(p=>{
      const d=new Date(p.pto_date+'T12:00:00');
      if(d.getFullYear()!==2026||d.getMonth()+1!==info.n) return false;
      if(sF&&p.staff_name!==sF) return false;
      if(srch&&!p.staff_name.toLowerCase().includes(srch)&&!p.staff_initials.toLowerCase().includes(srch)) return false;
      return true;
    }).forEach(p=>{
      const day=new Date(p.pto_date+'T12:00:00').getDate();
      if(!dayMap[day]) dayMap[day]=[];
      dayMap[day].push(p.staff_initials);
    });
    html+=`<div class="mc"><div class="mch">${month.toUpperCase()} 2026<span style="font-size:10px;color:var(--text2)">${[...new Set(Object.values(dayMap).flat())].length} staff</span></div><div class="cg">`;
    html+=['SUN','MON','TUE','WED','THU','FRI','SAT'].map(d=>`<div class="cdh">${d}</div>`).join('');
    for(let i=0;i<start;i++) html+=`<div class="cd empty"></div>`;
    for(let d=1;d<=info.d;d++){
      const dw=(start+d-1)%7,we=dw===0||dw===6;
      const hits=dayMap[d]||[];
      html+=`<div class="cd ${we?'we':''} ${hits.length?'hp':''}"><span class="dn">${d}</span>${hits.length?`<div class="pt">${hits.map(i=>`<span class="ptag">${i}</span>`).join('')}</div>`:''}</div>`;
    }
    const tot=start+info.d;for(let i=tot%7;i>0&&i<7;i++) html+=`<div class="cd empty"></div>`;
    html+=`</div></div>`;
  });
  document.getElementById('pto-grid').innerHTML=html;
}

function renderStaff(){
  const qF=document.getElementById('f-qual').value;
  const sF=document.getElementById('f-staff').value.toLowerCase().trim();
  let list=STAFF;
  if(qF) list=list.filter(s=>s.qualifications&&s.qualifications.includes(qF));
  if(sF) list=list.filter(s=>s.name.toLowerCase().includes(sF));
  document.getElementById('staff-sub').textContent=`${list.length} staff member${list.length!==1?'s':''}`;
  document.getElementById('staff-grid').innerHTML=list.map(s=>{
    const nHL=sF?hl(s.name,document.getElementById('f-staff').value):s.name;
    return`<div class="sc2"><div class="avl" style="background:${tc(s.name)}">${s.initials}</div><div style="flex:1;min-width:0"><div class="sn">${nHL}</div><div class="sm">ðŸ“… ${s.available_days}</div><div class="sq">${(s.qualifications||[]).map(q=>`<span class="dept-pill dp-${q}">${q}</span>`).join('')}</div>${s.pto_dates?`<div class="sp"><div class="spl">PTO 2026</div><div>${s.pto_dates}</div></div>`:''}</div></div>`;
  }).join('');
}

loadAll();
// Auto-refresh every 2 minutes
setInterval(loadAll, 2*60*1000);
</script>
</body>
</html>
